<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
<head>
    <meta charset="UTF-8" />
    <title th:text="${post.title}">ê²Œì‹œê¸€ ìƒì„¸</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-bg': '#232b39',
                        'banner-yellow': '#facc15'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-main-bg min-h-screen w-full">
<!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="w-full flex items-center justify-between px-10 py-4 bg-main-bg">
    <!-- ë¡œê³  (ë©”ì¸ìœ¼ë¡œ ì´ë™) -->
    <a th:href="@{/}" class="text-banner-yellow text-2xl italic font-extrabold tracking-wide hover:underline">Banner</a>
    <!-- ë¡œê·¸ì¸/ë‚´ì •ë³´ ì˜ì—­: ì˜¤ë¥¸ìª½ ìƒë‹¨ -->
    <div class="flex items-center gap-3">
        <!-- ë¡œê·¸ì¸ ìƒíƒœ: ì´ë¦„/ë“±ê¸‰ -->
        <span th:if="${member != null}" class="flex items-center gap-2">
            <span class="text-gray-300 text-lg font-semibold" th:text="${member?.name ?: ''}">user01</span>
            <span class="text-blue-600 text-lg font-semibold" th:text="${member?.rank ?: ''}">Bronze</span>
            <form th:action="@{/logout}" method="post" class="inline ml-2">
                <button type="submit" class="text-sm bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">ë¡œê·¸ì•„ì›ƒ</button>
            </form>
        </span>
        <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì¸ ë²„íŠ¼ -->
        <span th:if="${member == null}">
            <a th:href="@{/}" class="bg-blue-500 text-white px-3 py-1 rounded-md font-semibold text-sm hover:bg-blue-600 transition-colors">ë¡œê·¸ì¸</a>
            <a th:href="@{/signup}" class="ml-2 text-yellow-600 underline text-sm font-semibold">íšŒì›ê°€ì…</a>
        </span>
    </div>
</nav>

<!-- ê²Œì‹œê¸€ ìƒì„¸ ì¹´ë“œ -->
<div class="w-full flex justify-center items-center min-h-[80vh]">
    <div class="w-full max-w-5xl bg-white rounded-2xl shadow-xl p-16">
		<div th:if="${member != null and post.member.memberId == member.memberId}" class="flex justify-end mb-2">
			<a th:href="@{/posts/{id}/edit(id=${post.postId})}"
			   class="bg-yellow-300 hover:bg-yellow-400 text-gray-800 text-xs px-3 py-1 rounded font-semibold shadow transition">
				âœï¸ ìˆ˜ì •
			</a>
			<!-- ì‚­ì œ ë²„íŠ¼ -->
			<form th:action="@{/posts/{id}/delete(id=${post.postId})}" method="post" onsubmit="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="inline">
				<button type="submit"
						class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-1 rounded font-semibold shadow transition">
					ğŸ—‘ï¸ ì‚­ì œ
				</button>
			</form>
		</div>
        <!-- ì œëª©/ì •ë³´ -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-2 md:mb-0" th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h1>
            <div class="flex items-center gap-4 text-gray-500 text-sm">
                <span th:text="'ì‘ì„±ì: ' + ${post.member.name}">ì‘ì„±ì: í™ê¸¸ë™</span>
                <span th:text="${post.postTime}">2025-06-17 14:00</span>
                <span th:text="'ì¡°íšŒìˆ˜: ' + ${post.viewCount}">ì¡°íšŒìˆ˜: 12</span>
            </div>
        </div>
        <!-- ë³¸ë¬¸ -->
        <div class="border-t border-b py-10 text-gray-700 text-lg min-h-[350px]" th:utext="${post.contents}">
            ê²Œì‹œê¸€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>	
		<!-- ëŒ“ê¸€ ëª©ë¡ -->
		<div th:each="reply : ${topLevelReplies}" class="mb-5 text-[80%]">
		    <div class="flex items-center gap-2">
		        <span th:text="${reply.member.name}">ëŒ“ê¸€ì‘ì„±ì</span>
		        <span class="text-xs text-gray-400" th:text="${reply.replyTime}">2025-06-17 14:00</span>
		        <button type="button"
			        class="ml-2 text-green-500 hover:underline text-xs reply-toggle-btn"
			        th:attr="data-reply-id=${reply.replyId}">ë‹µê¸€</button>
		        <!-- ë³¸ì¸ ëŒ“ê¸€ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ -->
		        <span th:if="${member != null and reply.member.memberId == member.memberId}">
		            <button type="button" class="ml-2 text-blue-500 hover:underline text-xs edit-btn"
		                    th:attr="data-reply-id=${reply.replyId}">ìˆ˜ì •</button>
		            <form th:action="@{/posts/{postId}/comment/{replyId}/delete(postId=${post.postId}, replyId=${reply.replyId})}"
		                  method="post" style="display:inline;">
		                <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
		                        class="ml-1 text-red-500 hover:underline text-xs bg-transparent border-0 p-0">ì‚­ì œ</button>
		            </form>
		        </span>
		    </div>
		    <!-- ëŒ“ê¸€ ë‚´ìš© & ì¸ë¼ì¸ ìˆ˜ì • input -->
		    <div class="ml-2 text-gray-800">
		        <span th:id="'reply-content-' + ${reply.replyId}" th:text="${reply.contents}">ëŒ“ê¸€ ë‚´ìš©</span>
		        <form th:action="@{/posts/{id}/comment/{replyId}/edit(id=${post.postId}, replyId=${reply.replyId})}"
		              method="post" th:id="'edit-form-' + ${reply.replyId}" style="display:none;" class="inline">
		            <input type="text" name="content" th:value="${reply.contents}" class="border rounded px-2 py-1 text-xs" required>
		            <button type="submit" class="bg-blue-400 text-white px-2 py-1 rounded text-xs">ì™„ë£Œ</button>
		            <button type="button" class="bg-gray-300 px-2 py-1 rounded text-xs cancel-edit-btn" th:attr="data-reply-id=${reply.replyId}">ì·¨ì†Œ</button>
		        </form>
		    </div>
		    <!-- ëŒ€ëŒ“ê¸€ í¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
		    <form th:if="${member != null}" th:action="@{/posts/{id}/comment(id=${post.postId})}" method="post"
		          th:id="'reply-form-' + ${reply.replyId}" style="display:none;" class="flex gap-2 mt-1 ml-8">
		        <input type="hidden" name="parent" th:value="${reply.replyId}" />
		        <input type="text" name="content" class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required>
		        <button type="submit" class="bg-blue-400 text-white px-3 py-1 rounded text-xs">ë‹µê¸€</button>
		    </form>
		    <!-- ëŒ€ëŒ“ê¸€ ì¶œë ¥ -->
		    <div th:if="${childReplyMap[reply.replyId] != null}">
		        <div th:each="child : ${childReplyMap[reply.replyId]}" class="ml-8 mt-1">
		            <div class="flex items-center gap-2">
		                <span th:text="${child.member.name}">ëŒ€ëŒ“ê¸€ì‘ì„±ì</span>
		                <span class="text-xs text-gray-400" th:text="${child.replyTime}">2025-06-17 14:00</span>
		                <button type="button"
					        class="ml-2 text-green-500 hover:underline text-xs reply-toggle-btn"
					        th:attr="data-reply-id=${child.replyId}">ë‹µê¸€</button>
		                <!-- ë³¸ì¸ ëŒ€ëŒ“ê¸€ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ -->
		                <span th:if="${member != null and child.member.memberId == member.memberId}">
		                    <button type="button" class="ml-2 text-blue-500 hover:underline text-xs edit-btn"
		                            th:attr="data-reply-id=${child.replyId}">ìˆ˜ì •</button>
		                    <form th:action="@{/posts/{postId}/comment/{replyId}/delete(postId=${post.postId}, replyId=${child.replyId})}"
		                          method="post" style="display:inline;">
		                        <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
		                                class="ml-1 text-red-500 hover:underline text-xs bg-transparent border-0 p-0">ì‚­ì œ</button>
		                    </form>
		                </span>
		            </div>
		            <div class="ml-2 text-gray-800">
		                <span th:id="'reply-content-' + ${child.replyId}" th:text="${child.contents}">ëŒ€ëŒ“ê¸€ ë‚´ìš©</span>
		                <form th:action="@{/posts/{id}/comment/{replyId}/edit(id=${post.postId}, replyId=${child.replyId})}"
		                      method="post" th:id="'edit-form-' + ${child.replyId}" style="display:none;" class="inline">
		                    <input type="text" name="content" th:value="${child.contents}" class="border rounded px-2 py-1 text-xs" required>
		                    <button type="submit" class="bg-blue-400 text-white px-2 py-1 rounded text-xs">ì™„ë£Œ</button>
		                    <button type="button" class="bg-gray-300 px-2 py-1 rounded text-xs cancel-edit-btn" th:attr="data-reply-id=${child.replyId}">ì·¨ì†Œ</button>
		                </form>
		            </div>
		            <form th:if="${member != null}" th:action="@{/posts/{id}/comment(id=${post.postId})}" method="post"
		                  th:id="'reply-form-' + ${child.replyId}" style="display:none;" class="flex gap-2 mt-1 ml-8">
		                <input type="hidden" name="parent" th:value="${child.replyId}" />
		                <input type="text" name="content" class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required>
		                <button type="submit" class="bg-blue-400 text-white px-3 py-1 rounded text-xs">ë‹µê¸€</button>
		            </form>
		        </div>
		    </div>
		</div>
		<form th:if="${member != null}" th:action="@{/posts/{id}/comment(id=${post.postId})}" method="post" class="mb-8 flex gap-2">
		    <input type="hidden" name="parent" value="" />
		    <input type="text" name="content" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required>
		    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700">ëŒ“ê¸€ ë“±ë¡</button>
		</form>
		
		<div th:if="${member == null}" class="mt-6 text-center text-gray-400 text-sm">
		    ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a th:href="@{/}" class="text-blue-600 hover:underline">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.
		</div>
		
		<script>
		document.addEventListener('DOMContentLoaded', function () {
		    // ì¸ë¼ì¸ ìˆ˜ì • í¼ í† ê¸€
		    document.querySelectorAll('.edit-btn').forEach(function (btn) {
		        btn.addEventListener('click', function () {
		            var replyId = btn.getAttribute('data-reply-id');
		            document.getElementById('reply-content-' + replyId).style.display = 'none';
		            document.getElementById('edit-form-' + replyId).style.display = 'inline';
		        });
		    });
		    document.querySelectorAll('.cancel-edit-btn').forEach(function (btn) {
		        btn.addEventListener('click', function () {
		            var replyId = btn.getAttribute('data-reply-id');
		            document.getElementById('reply-content-' + replyId).style.display = 'inline';
		            document.getElementById('edit-form-' + replyId).style.display = 'none';
		        });
		    });
		    document.querySelectorAll('.reply-toggle-btn').forEach(function (btn) {
		        btn.addEventListener('click', function () {
		            var replyId = btn.getAttribute('data-reply-id');
		            var form = document.getElementById('reply-form-' + replyId);
		            if (form) {
		                form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'flex' : 'none';
		            }
		        });
		    });
		});
		</script>

        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <div class="mt-10 text-center">
            <a th:href="@{/}" class="inline-block bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors">ëª©ë¡ìœ¼ë¡œ</a>
        </div>
    </div>
</div>
</body>
</html>
